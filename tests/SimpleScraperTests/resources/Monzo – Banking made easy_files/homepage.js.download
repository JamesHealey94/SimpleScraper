var isProduction = window.location.href.indexOf('https://monzo.com') >= 0

var SAVINGS_API_BASE_PATH = isProduction
  ? 'https://api.monzo.com'
  : 'https://api.s101.nonprod-ffs.io'

var SAVINGS_DEV_CLIENT_SECRET =
  'vPI4zuR25uZKl4h2hq59WvHcUeVS2dpHDCl7/k3gY0WPaEGXf1dS5NBIsnhvu2q4gNFs9Y9Zoos0bfCgHFS2'

var SAVINGS_DEV_CLIENT_ID = 'oauthclient_000094oi2ytifdsiO84Xfl'

var SAVINGS_PROD_CLIENT_SECRET =
  'vPI4zuR25uZKl4h2hq59WvHcUeVS2dpHDCl7/k3gY0WPaEGXf1dS5NBIsnhvu2q4gNFs9Y9Zoos0bfCgHFS2'

var SAVINGS_PROD_CLIENT_ID = 'oauthclient_000094oi2ytifdsiO84Xfl'

var SAVINGS_CLIENT_SECRET = isProduction
  ? SAVINGS_PROD_CLIENT_SECRET
  : SAVINGS_DEV_CLIENT_SECRET

var SAVINGS_CLIENT_ID = isProduction
  ? SAVINGS_PROD_CLIENT_ID
  : SAVINGS_DEV_CLIENT_ID

function rateTypeText(rate) {
  let result = '(AER, variable)'
  if (rate.type === 'fixed_savings') {
    result = '(AER, fixed)'
  }
  return result
}

// Rates logic
function refreshHeadlineRate(access_token) {
  $.get({
    url: SAVINGS_API_BASE_PATH + '/pots/savings/issues/headline',
    headers: { Authorization: 'Bearer ' + access_token },
    timeout: 2000, //ms
  })
    .done(function(rate) {
      if (rate == null || rate.savings_description_paragraphs[0] == null) {
        document.getElementById('saving-section').innerHTML = ''
        return
      }
      document.getElementById('savings-1').innerHTML =
        rate.savings_description_paragraphs[0]
      if (rate.savings_description_paragraphs[1] != null) {
        document.getElementById('savings-2').innerHTML =
          rate.savings_description_paragraphs[1]
      }
    })
    .fail(function() {
      // Network failure means no savings section
      document.getElementById('saving-section').innerHTML = ''
      return
    })
}

$.post({
  url: SAVINGS_API_BASE_PATH + '/oauth2/token',
  data: {
    grant_type: 'client_credentials',
    client_id: SAVINGS_CLIENT_ID,
    client_secret: SAVINGS_CLIENT_SECRET,
  },
  timeout: 2000, //ms
})
  .done(function(authResponse) {
    refreshHeadlineRate(authResponse.access_token)
  })
  .fail(function() {
    // Network failure means no savings section
    document.getElementById('saving-section').innerHTML = ''
    return
  })
